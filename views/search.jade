
extends layout

block content
  div.container-fluid
   div.row-fluid
    div#map_canvas.span8
    div#result.span4
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCbjWBf6HYAhNcEyNFfxU2qdh6fzw7HJ5Y&libraries=places&sensor=true"></script>
    script
      var map;
      var service;
      var infowindow = new google.maps.InfoWindow;

      function initialize() {
        var loc = new google.maps.LatLng(#{lat}, #{lng});
        map = new google.maps.Map(document.getElementById("map_canvas"),
          {
            center: loc,
            zoom: 12,
            mapTypeId: google.maps.MapTypeId.ROADMAP
          });
        
        var request = {
          location: loc,
          radius: 5000
        };

        service = new google.maps.places.PlacesService(map);
        service.nearbySearch(request, callback);
      }

      function callback(result, status)
      {
        if(status == google.maps.places.PlacesServiceStatus.OK)
          for(var i=0; i<min(result.length, 10); i++)
            createMarker(result[i]);
      }

      function createMarker(place)
      {
        var placeLoc = place.geometry.location;
        // prepare marker options
        var opts  = new google.maps.MarkerOptions({icon:icon: 'http://www.portlandbiblecollege.org/files/6712/6290/3212/Hotel%20Icon%20black.png'});
        opts.fillStyle = new FillStyle({color: 0x00ff00, alpha: .7});
        //opts.label = label;
        //opts.tooltip = tooltip;
        var marker = new google.maps.Marker({
        map: map,
        flat:false,
        position: placeLoc
        });
        
        var type = place.types[0];
        for(var i=1;i<place.types.length;i++)
          type = type + ", " + place.types[i];

        var resultelem = document.getElementById('result');
        resultelem.innerHTML = resultelem.innerHTML + "<div class=\"hero-unit\"><h5>" + place.name + "</h5><p>Rating: " +  place.rating + "<br /> Type: " + type + "</p></div>";

        google.maps.event.addListener(marker, 'click', function() {
          infowindow.setContent(place.name + "<br />Rating: " +  place.rating + "<br /> Type:" + type);
          infowindow.open(map, this);
        });
      }

      function min(a, b)
      {
        if(a<b)
          return a;
        else
          return b;
      }

      initialize();

